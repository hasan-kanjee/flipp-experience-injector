async function addFlippExperience() {
  console.log("START");

  console.log(window.flippxp);

  var e = document.getElementById("flipp-scroll-ad-content");
  e.innerHTML = "";

  !function(){"use strict";var e=function(e,t,i){var n=t.getBoundingClientRect(),o={top:n.top,height:n.height,bottom:n.bottom};if(i!==t.ownerDocument.defaultView){var r=e.getBoundingClientRect();o.top=r.top+n.top,o.height=Math.min(o.height,r.height),o.bottom=o.top+o.height}if(0===o.height)return null;var a=o.height,s=0;return o.top>i.innerHeight||o.bottom<=0?{top:0,height:0,screenHeight:i.innerHeight}:(o.top<0&&(a-=s=-o.top),o.bottom>i.innerHeight&&(a-=o.bottom-i.innerHeight),{top:s,height:a=Math.max(a,0),screenHeight:i.innerHeight})},t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i={};!function(e){var i,n,o,r,a,s,l;Object.defineProperty(e,"__esModule",{value:!0}),function(e){e.FlippApp="FlippApp",e.ReebeeApp="ReebeeApp",e.FlippWeb="FlippWeb",e.Flyers="Flyers",e.Hosted="Hosted",e.GMA="GMA",e.Editorials="Editorials",e.Hero="Hero",e.ShopperPlatform="ShopperPlatform",e.Other="Other",e.FlippAvroDefault="FlippAvroDefault"}(i||(i={})),function(e){e.Prod="Prod",e.Dev="Dev",e.Test="Test"}(n||(n={})),function(e){e.StorefrontInline="StorefrontInline",e.StorefrontExpanded="StorefrontExpanded",e.UlpInline="UlpInline",e.UlpExpanded="UlpExpanded"}(o||(o={})),function(e){e.Default="Default",e.Safeframe="Safeframe",e.Enabler="Enabler",e.WebView="WebView"}(r||(r={})),function(e){e.Desktop="Desktop",e.Mobile="Mobile",e.Tablet="Tablet"}(a||(a={})),function(e){e.CA="CA",e.US="US"}(s||(s={})),function(e){e.Flyer="Flyer",e.Merchant="Merchant",e.Ecom="Ecom"}(l||(l={}));var d,c=Object.freeze({__proto__:null,get ApplicationID(){return i},get Environment(){return n},get ShopperPlatformUx(){return o},get ShopperPlatformAdView(){return r},get Platform(){return a},get Country(){return s},get ItemType(){return l},ExperienceServedFallbackSchemaId:3726,ExperienceInViewFlyerSchemaId:3727,ExperienceScrolledBeyondSlotSchemaId:3754,StorefrontHeartbeatFlyerSchemaId:3728,StorefrontOpenFlyerSchemaId:3729,StorefrontEngagedVisitFlyerSchemaId:3730,StorefrontImpressionFlyerItemSchemaId:3731,StorefrontClickFlyerItemDetailsSchemaId:3732,StorefrontClickSeeFullFlyerSchemaId:3733,StorefrontClickSkipFlyerSchemaId:3734,ItemDetailsClickTransferToMerchantSchemaId:3735,ItemDetailsClickSaveSchemaId:3736,AppInitializedSchemaId:3737,DecisionRequestContextSchemaId:3738,DecisionRequestMadeSchemaId:3739,DecisionResponseSuccessSchemaId:3740,DecisionResponseFailureSchemaId:3741,LandingHeartbeatPageSchemaId:3742,LandingInViewSchemaId:3743,LandingOpenPageSchemaId:3744,LandingItemClickSchemaId:3745,LandingItemClickSaveSchemaId:3746,LandingItemClickTransferToMerchantSchemaId:3747,LandingEngagedVisitPageSchemaId:3748,LandingImpressionItemSchemaId:3749,SurveyOpenSchemaId:3750,SurveyClickSchemaId:3751,ExperienceMeasuredTestSchemaId:3752}),u="production";e.TagType=void 0,(d=e.TagType||(e.TagType={})).PIXEL="pixel",d.SCRIPT="script";var p=function(){function e(){}return e.prototype.debug=function(){},e.prototype.warn=function(e){console.warn(e)},e.prototype.error=function(e,t){console.error(e,t)},e}(),h=new p,f=new(function(){function e(){this.hasStarted=!1,this.queue=[]}return e.prototype.enqueue=function(e){e&&this.hasStarted&&this.queue.push(e)},e.prototype.start=function(){var e=this;this.hasStarted=!0,window.setInterval((function(){e.flush()}),100)},e.prototype.stop=function(){this.hasStarted=!1},e.prototype.flush=function(){this.queue.length&&(h.debug("Flushing analytics queue",this.queue),fetch("https://p.flipp.com/beacons",{method:"POST",credentials:"include",headers:{"Content-Type":"text/plain; charset=UTF-8"},body:encodeURIComponent(JSON.stringify(this.queue))}),this.queue=[])},e}());f.start();var m,v,g=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},w=((m={})[e.TagType.PIXEL]=function(e,t){var i;try{var n=function(e){var t=Math.floor(1e7+9e7*Math.random());return e.replace(/\[\[random\]\]/g,t.toString())}(e);i=new URL(n)}catch(t){return void console.error("Invalid pixel url: ".concat(e))}if(t)for(var o in t)i.searchParams.set(o,t[o]);new Image(1,1).src=i.toString()},m[e.TagType.SCRIPT]=function(e){var t=document.createElement("script");t.innerHTML=e,t.id=g(),document.body.append(t),t.remove()},m),b=new function(){var t=this;this.processedTags=[],this.addTags=function(i){if(i)for(var n in i){var o=n;for(var r in i[o]){var a=r,s=e.TagType.PIXEL,l=i[o][a];l&&("string"!=typeof l&&(s=l.type,l=l.content),t.processedTags.push({type:s,source:o,event:a,content:l}))}}},this.sendOpen=function(){h.debug("Tags: Send open"),t.send("open")},this.sendEngagement=function(){h.debug("Tags: Send engagement"),t.send("engagement")},this.sendClick=function(e){h.debug("Tags: Send click"),t.send("click",{flyerItemId:e})},this.sendServedImpression=function(){h.debug("Tags: Send served impression"),t.send("impression")},this.sendAnswerClick=function(e){h.debug("Tags: Send Survey click: "+e),t.send("engagement",{answer:e})},this.send=function(e,i){t.processedTags.filter((function(t){return t.event===e})).forEach((function(e){return function(e,t,i){w[e](t,i)}(e.type,e.content,i)}))}};e.PostMessageEvent=void 0,(v=e.PostMessageEvent||(e.PostMessageEvent={})).APP_CONFIG="app-config",v.ANALYTICS_CONFIG="analytics-config",v.INLINE_GEOMETRY="inline-geometry",v.SFML_VIEWPORT="sfml-viewport",v.IFRAME_HEIGHT_RESIZE="iframe-height-resize",v.REQUEST_EXPAND="request-expand",v.END_PREVIEW="end-preview",v.COUNTDOWN_STATE="countdown-state",v.ULP="flipp-ulp",v.MEASURE_TEST="measure-test";var E,y,I,x=function(){function e(e,t,i,n,o,r){this.emitter=e,this.eventType=t,this.listener=i,this.key=n,this.options=o,this.context=r}return e.prototype.remove=function(){var e=this.emitter.getSubscriptions(this.eventType);e&&delete e[this.key]},e}(),M=function(){function e(){this.subscriptionsForType=new Map}return e.prototype.addListener=function(e,t,i,n){var o,r=null!==(o=this.subscriptionsForType.get(e))&&void 0!==o?o:[],a=new x(this,e,t,r.length,i,n);return r.push(a),this.subscriptionsForType.set(e,r),a},e.prototype.emit=function(e,t){for(var i,n,o=0,r=null!==(i=this.subscriptionsForType.get(e))&&void 0!==i?i:[];o<r.length;o++){var a=r[o];a.listener.call(a.context,new CustomEvent(e.toString(),{detail:t})),(null===(n=a.options)||void 0===n?void 0:n.once)&&a.remove()}},e.prototype.getSubscriptions=function(e){return this.subscriptionsForType.get(e)},e}(),T="message",S=function(){function t(){var t=this;this.addEventListener=function(e,i,n){var o=t.eventEmmiter.addListener(e,i,n);return(null==n?void 0:n.sendRequest)&&n.target&&t.sendMessage("request-"+e,n.requestData,n.target),o},this.sendMessage=function(e,t,i){void 0===i&&(i=window),i.postMessage({type:e,data:t},"*")},this.handleMessage=function(e){t.isMessageRelevant(e.data)&&t.eventEmmiter.emit(e.data.type,e.data.data)},this.isMessageRelevant=function(t){if(!t.type)return!1;for(var i=0,n=Object.values(e.PostMessageEvent);i<n.length;i++)if(n[i]===t.type)return!0;return!1},this.eventEmmiter=new M,this.start()}return t.prototype.start=function(){window.addEventListener(T,this.handleMessage)},t.prototype.stop=function(){window.removeEventListener(T,this.handleMessage)},t}(),k=new S;e.UXType=void 0,(E=e.UXType||(e.UXType={})).INLINE="inline",E.DEFAULT="default",E.ULP="ulp",E.SURVEY="survey",e.AppAdViewType=void 0,(y=e.AppAdViewType||(e.AppAdViewType={})).SafeFrame="safeframe",y.Enabler="enabler",y.Native="native",y.Demo="demo",e.TimedActionType=void 0,(I=e.TimedActionType||(e.TimedActionType={})).SCROLL="scroll",I.ENGAGEMENT="engagement",I.OPEN="open",I.HEARTBEAT="heartbeat";var C,P,_,U,L=function(){return L=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},L.apply(this,arguments)};!function(e){e.CONTENT_READY="content-ready",e.CONTENT_LOAD_ERROR="content-load-error",e.REQUEST_TAP="request-tap",e.EXPERIENCE_LOAD="experience-load",e.REQUEST_RESIZE="request-resize",e.REQUEST_GO_TO_URL="request-go-to-url",e.REQUEST_ADD_TO_LIST="request-add-to-list",e.EXPERIENCE_VIEWPORT="experience-viewport"}(C||(C={}));var R=function(e,t){var i=JSON.stringify({type:e,detail:t});if("ios"===P.platform&&window.webkit)try{window.webkit.messageHandlers.NativeXBridge.postMessage(i)}catch(e){console.error("Error messaging iOS",e)}else if("android"===P.platform&&window.NativeXBridge)try{window.NativeXBridge.postMessage(i)}catch(e){console.error("Error messaging Android",e)}},A=null;function N(e){if(void 0===e&&(e={}),A)return A;if("userKey"in e&&e.userKey)return A=e.userKey,e.userKey;for(var t="flipp-uid",i=null,n=document.cookie.split(";"),o=0;o<n.length;o++){var r=n[o].split("="),a=r[0],s=r[1];if(a.trim()===t){i=s;break}}return i||((A=g())?(document.cookie=t+"="+A+"; max-age=31536000; path=/",A):null)}var D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},O={};!function(e,t){!function(i,n){var o="function",r="undefined",a="object",s="string",l="model",d="name",c="type",u="vendor",p="version",h="architecture",f="console",m="mobile",v="tablet",g="smarttv",w="wearable",b="embedded",E="Amazon",y="Apple",I="ASUS",x="BlackBerry",M="Browser",T="Chrome",S="Firefox",k="Google",C="Huawei",P="LG",_="Microsoft",U="Motorola",L="Opera",R="Samsung",A="Sharp",N="Sony",D="Xiaomi",O="Zebra",q="Facebook",B=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},H=function(e,t){return typeof e===s&&-1!==z(t).indexOf(z(e))},z=function(e){return e.toLowerCase()},F=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===r?e:e.substring(0,350)},W=function(e,t){for(var i,r,s,l,d,c,u=0;u<t.length&&!d;){var p=t[u],h=t[u+1];for(i=r=0;i<p.length&&!d;)if(d=p[i++].exec(e))for(s=0;s<h.length;s++)c=d[++r],typeof(l=h[s])===a&&l.length>0?2===l.length?typeof l[1]==o?this[l[0]]=l[1].call(this,c):this[l[0]]=l[1]:3===l.length?typeof l[1]!==o||l[1].exec&&l[1].test?this[l[0]]=c?c.replace(l[1],l[2]):n:this[l[0]]=c?l[1].call(this,c,l[2]):n:4===l.length&&(this[l[0]]=c?l[3].call(this,c.replace(l[1],l[2])):n):this[l]=c||n;u+=2}},V=function(e,t){for(var i in t)if(typeof t[i]===a&&t[i].length>0){for(var o=0;o<t[i].length;o++)if(H(t[i][o],e))return"?"===i?n:i}else if(H(t[i],e))return"?"===i?n:i;return e},G={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,p],[/opios[\/ ]+([\w\.]+)/i],[p,[d,L+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[d,L]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[d,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[d,"UC"+M]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[d,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[d,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[d,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+M],p],[/\bfocus\/([\w\.]+)/i],[p,[d,S+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[d,L+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[d,L+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[d,"MIUI "+M]],[/fxios\/([-\w\.]+)/i],[p,[d,S]],[/\bqihu|(qi?ho?o?|360)browser/i],[[d,"360 "+M]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1 "+M],p],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[d,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,q],p],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[d,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[d,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[d,T+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,T+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[d,"Android "+M]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[p,V,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[d,S+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,z]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",z]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,z]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[u,R],[c,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[u,R],[c,m]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[u,y],[c,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[u,y],[c,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[u,C],[c,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[u,C],[c,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[u,D],[c,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[u,D],[c,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[u,"OPPO"],[c,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[u,"Vivo"],[c,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[u,"Realme"],[c,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[u,U],[c,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[u,U],[c,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[u,P],[c,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[u,P],[c,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[u,"Lenovo"],[c,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[u,"Nokia"],[c,m]],[/(pixel c)\b/i],[l,[u,k],[c,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[u,k],[c,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[u,N],[c,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[u,N],[c,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[u,"OnePlus"],[c,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[u,E],[c,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[u,E],[c,m]],[/(playbook);[-\w\),; ]+(rim)/i],[l,u,[c,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[u,x],[c,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[u,I],[c,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[u,I],[c,m]],[/(nexus 9)/i],[l,[u,"HTC"],[c,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[l,/_/g," "],[c,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[u,"Acer"],[c,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[u,"Meizu"],[c,m]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[u,A],[c,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,l,[c,m]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,l,[c,v]],[/(surface duo)/i],[l,[u,_],[c,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[u,"Fairphone"],[c,m]],[/(u304aa)/i],[l,[u,"AT&T"],[c,m]],[/\bsie-(\w*)/i],[l,[u,"Siemens"],[c,m]],[/\b(rct\w+) b/i],[l,[u,"RCA"],[c,v]],[/\b(venue[\d ]{2,7}) b/i],[l,[u,"Dell"],[c,v]],[/\b(q(?:mv|ta)\w+) b/i],[l,[u,"Verizon"],[c,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[u,"Barnes & Noble"],[c,v]],[/\b(tm\d{3}\w+) b/i],[l,[u,"NuVision"],[c,v]],[/\b(k88) b/i],[l,[u,"ZTE"],[c,v]],[/\b(nx\d{3}j) b/i],[l,[u,"ZTE"],[c,m]],[/\b(gen\d{3}) b.+49h/i],[l,[u,"Swiss"],[c,m]],[/\b(zur\d{3}) b/i],[l,[u,"Swiss"],[c,v]],[/\b((zeki)?tb.*\b) b/i],[l,[u,"Zeki"],[c,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],l,[c,v]],[/\b(ns-?\w{0,9}) b/i],[l,[u,"Insignia"],[c,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[u,"NextBook"],[c,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],l,[c,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],l,[c,m]],[/\b(ph-1) /i],[l,[u,"Essential"],[c,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[u,"Envizen"],[c,v]],[/\b(trio[-\w\. ]+) b/i],[l,[u,"MachSpeed"],[c,v]],[/\btu_(1491) b/i],[l,[u,"Rotor"],[c,v]],[/(shield[\w ]+) b/i],[l,[u,"Nvidia"],[c,v]],[/(sprint) (\w+)/i],[u,l,[c,m]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[u,_],[c,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[u,O],[c,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[u,O],[c,m]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,l,[c,f]],[/droid.+; (shield) bui/i],[l,[u,"Nvidia"],[c,f]],[/(playstation [345portablevi]+)/i],[l,[u,N],[c,f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[u,_],[c,f]],[/smart-tv.+(samsung)/i],[u,[c,g]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[u,R],[c,g]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,P],[c,g]],[/(apple) ?tv/i],[u,[l,y+" TV"],[c,g]],[/crkey/i],[[l,T+"cast"],[u,k],[c,g]],[/droid.+aft(\w)( bui|\))/i],[l,[u,E],[c,g]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[u,A],[c,g]],[/(bravia[\w ]+)( bui|\))/i],[l,[u,N],[c,g]],[/(mitv-\w{5}) bui/i],[l,[u,D],[c,g]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[u,F],[l,F],[c,g]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[c,g]],[/((pebble))app/i],[u,l,[c,w]],[/droid.+; (glass) \d/i],[l,[u,k],[c,w]],[/droid.+; (wt63?0{2,3})\)/i],[l,[u,O],[c,w]],[/(quest( 2)?)/i],[l,[u,q],[c,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[c,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[c,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[c,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[c,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[c,m]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[d,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[d,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[d,[p,V,G]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[d,"Windows"],[p,V,G]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,"Mac OS"],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,p],[/\(bb(10);/i],[p,[d,x]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[d,S+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[d,"webOS"]],[/crkey\/([\d\.]+)/i],[p,[d,T+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[d,"Chromium OS"],p],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,p],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[d,p]]},j=function(e,t){if(typeof e===a&&(t=e,e=n),!(this instanceof j))return new j(e,t).getResult();var o=e||(typeof i!==r&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),f=t?function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i}(K,t):K;return this.getBrowser=function(){var e,t={};return t[d]=n,t[p]=n,W.call(t,o,f.browser),t.major=typeof(e=t.version)===s?e.replace(/[^\d\.]/g,"").split(".")[0]:n,t},this.getCPU=function(){var e={};return e[h]=n,W.call(e,o,f.cpu),e},this.getDevice=function(){var e={};return e[u]=n,e[l]=n,e[c]=n,W.call(e,o,f.device),e},this.getEngine=function(){var e={};return e[d]=n,e[p]=n,W.call(e,o,f.engine),e},this.getOS=function(){var e={};return e[d]=n,e[p]=n,W.call(e,o,f.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return o},this.setUA=function(e){return o=typeof e===s&&e.length>350?F(e,350):e,this},this.setUA(o),this};j.VERSION="1.0.32",j.BROWSER=B([d,p,"major"]),j.CPU=B([h]),j.DEVICE=B([l,u,c,f,m,g,v,w,b]),j.ENGINE=j.OS=B([d,p]),e.exports&&(t=e.exports=j),t.UAParser=j;var Q=typeof i!==r&&(i.jQuery||i.Zepto);if(Q&&!Q.ua){var X=new j;Q.ua=X.getResult(),Q.ua.get=function(){return X.getUA()},Q.ua.set=function(e){X.setUA(e);var t=X.getResult();for(var i in t)Q.ua[i]=t[i]}}}("object"==typeof window?window:D)}({get exports(){return O},set exports(e){O=e}},O);var q=O,B="UNKNOWN",H="NA",z=function(){function e(){}return e.prototype.getDeviceInfo=function(e){if(this.deviceInfo)return this.deviceInfo;var t=(new q).getResult(),i=t.browser,n=t.os,o=t.device;return this.deviceInfo=L({browser:i.name||B,browserVersion:i.version||H,devicePixelRatio:Math.round(1e3*window.devicePixelRatio)||0,host:document.referrer,iframeWidth:window.innerWidth,screenHeight:window.screen.height,screenWidth:window.screen.width,system:n.name||B,systemModel:o.vendor||B,systemVersion:n.version||H,type:o.type||"desktop"},e),this.deviceInfo},e}(),F=new z,W=function(e,t){if(void 0===t&&(t=-1),"number"==typeof e)return e;if("string"==typeof e){var i=parseInt(e,10);return isNaN(i)?t:i}return t},V=0,G=g(),K=F.getDeviceInfo(),j=null;switch(K.type){case"mobile":j={"com.flipp.beacon.shopperPlatform.enumeration.Platform":a.Mobile};break;case"tablet":j={"com.flipp.beacon.shopperPlatform.enumeration.Platform":a.Tablet};break;case"desktop":j={"com.flipp.beacon.shopperPlatform.enumeration.Platform":a.Desktop};break;default:j=null}var Q=function(){return j};function X(e){return"CA"===e?{"com.flipp.beacon.shopperPlatform.enumeration.Country":s.CA}:"US"===e?{"com.flipp.beacon.shopperPlatform.enumeration.Country":s.US}:null}function Y(){var e=F.getDeviceInfo();return{browser:e.browser,browserVersion:e.browserVersion,system:e.system,systemModel:e.systemModel,systemVersion:e.systemVersion}}function Z(e){return e?{"com.flipp.beacon.shopperPlatform.entity.ShopperPlatformDecision":e}:null}function J(){var e;switch(u){case"development":e=n.Dev;break;case"staging":e=n.Test;break;default:e=n.Prod}return e}function $(e,t){return{partnerNameIdentifier:e||"",campaignNameIdentifier:t||""}}function ee(){var e=F.getDeviceInfo();return{viewWidth:e.screenWidth,viewHeight:e.screenHeight}}function te(e){return e.map((function(e){return{paramName:e[0],paramValue:e[1]}}))}function ie(e){return{aid:i.ShopperPlatform,rnd:Math.random().toString(),postalCode:e?{string:e}:null}}function ne(e,t,i,n,o,a,s,l){var d=F.getDeviceInfo().devicePixelRatio;return{environment:J(),clientParameters:Y(),epochMilliseconds:Date.now(),uuid:g(),usedFallbackPostalCode:e,sessionId:t,sequenceId:V++,viewSize:ee(),devicePixelRatio:d,appVersion:i,shopperPlatformCampaign:n,shopperPlatformConfig:o,shopperPlatformUx:a,shopperPlatformAdView:r.Default,site:s,uid:l}}var oe,re=function(e,t,i,n,r,a,s){return{base:ie(r),shopperPlatformBase:ne(!1,G,"0.29.1",$(t,a),{openViewRatio:0,openTimerMs:0,evTimerMs:0},null!=s?s:o.StorefrontInline,window.location.hostname,N({})||"unknown"),siteId:W(i),zoneId:W(n),schemaInfo:{schemaId:e},platform:Q()}};e.ULPMessageType=void 0,(oe=e.ULPMessageType||(e.ULPMessageType={})).CLICK_MEATBALL="CLICK_MEATBALL",oe.SEE_ITEM="SEE_ITEM",oe.CLIP_ITEM="CLIP_ITEM",oe.SEE_MERCHANT_ITEM="SEE_MERCHANT_ITEM",oe.CLIP_MERCHANT_ITEM="CLIP_MERCHANT_ITEM",oe.CLICK="CLICK",oe.CLIP_ECOM_ITEM="CLIP_ECOM_ITEM",oe.ITEM_IMPRESSION="ITEM_IMPRESSION";var ae=function(e,t){var i=t.detail,n={merchantId:i.merchant_id},o=null,r=null,a=null;switch(e){case l.Flyer:o={"com.flipp.beacon.shopperPlatform.entity.FlyerItemData":{flyer:{flyerId:W(i.flyer_id,0),flyerRunId:-1,flyerTypeId:-1,storeId:null,premium:!!i.premium},flyerItem:{id:W(i.flyer_item_id,0)}}};break;case l.Merchant:r={"com.flipp.beacon.shopperPlatform.entity.MerchantItemData":{merchantItem:{globalID:i.global_id||"-1",price:{double:i.price||-1}},storeId:i.store_code?W(i.store_code):-1,url:i.link||""}};break;case l.Ecom:a={"com.flipp.beacon.shopperPlatform.entity.EcomItemData":{ecomItem:{id:i.id?W(i.id):-1,itemId:i.item_id?{string:i.item_id||""}:null,sku:i.sku?{string:i.sku||""}:null},url:i.link||""}}}return{itemType:e,merchant:n,flyerItemData:o,merchantItemData:r,ecomItemData:a}},se=function(e){switch(e){case"flyer":return l.Flyer;case"merchant_item":return l.Merchant;case"ecom":return l.Ecom;default:throw new Error("ULP item type not recognized")}},le=function(e,t,i,n){return{campaignId:e.campaignId,flightId:e.flightId,advertiserId:e.advertiserId,creativeId:e.creativeId,adId:e.adId,siteId:t,zoneId:i,customUrl:n?{string:n}:null}};e.AnalyticBeacons=c,e.AnalyticsQueue=f,e.DeviceService=F,e.EventSubscription=x,e.Logger=h,e.NA_VALUE=H,e.PostMessageService=k,e.REQUEST_PREFIX="request-",e.Service=z,e.Tags=b,e.ULPMessageEvent={CLICK_MEATBALL:"CLICK_MEATBALL",SEE_FLYER_ITEM:"SEE_ITEM",CLIP_FLYER_ITEM:"CLIP_ITEM",SEE_MERCHANT_ITEM:"SEE_MERCHANT_ITEM",CLIP_MERCHANT_ITEM:"CLIP_MERCHANT_ITEM",SEE_ECOM_ITEM:"CLICK",CLIP_ECOM_ITEM:"CLIP_ECOM_ITEM",ITEM_IMPRESSION:"ITEM_IMPRESSION"},e.UNKNOWN_VALUE=B,e.asNumber=W,e.createAppInitializedBeacon=function(e,t,i){return L({},re(3737,e,t,i))},e.createBaseBeacon=re,e.createBeaconCountry=X,e.createDecisionRequestContextBeacon=function(e,t,i,n,o,r,a,s,l){return L(L({},re(3738,e,t,i,o)),{country:X(n),keywords:r,category:a,pageUrl:s,queryParams:te(l)})},e.createDecisionRequestMadeBeacon=function(e,t,i,n,o){return L(L({},re(3739,e,t,i,o)),{country:X(n)})},e.createDecisionResponseFailureBeacon=function(e,t,i,n,o,r,a){return L(L({},re(3741,e,t,i,o)),{country:X(n),errorMessage:r,responseCode:a})},e.createDecisionResponseSuccessBeacon=function(e,t,i,n,o,r){return L(L({},re(3740,e,t,i,o)),{country:X(n),decisions:r})},e.createUlpClickBeacon=function(t,i,n,r,a,s,l,d,c){return L(L({},re(function(t){switch(t){case e.ULPMessageType.CLICK_MEATBALL:return 3745;case e.ULPMessageType.CLIP_ITEM:case e.ULPMessageType.CLIP_MERCHANT_ITEM:case e.ULPMessageType.CLIP_ECOM_ITEM:return 3746;case e.ULPMessageType.SEE_ITEM:case e.ULPMessageType.SEE_MERCHANT_ITEM:case e.ULPMessageType.CLICK:return 3747;default:throw new Error("No schema associated with ULP message")}}(s.type),t,n,r,d,c,o.UlpInline)),{itemData:ae(l,s),decision:Z(le(i,n,r,a))})},e.createUlpEngagementBeacon=function(e,t,i,n,r,a,s){return L(L({},re(3748,e,i,n,a,s,o.UlpInline)),{decision:Z(le(t,i,n,r))})},e.createUlpHeartbeatBeacon=function(e,t,i,n,r,a,s,l){return L(L({},re(3742,e,n,r,s,l,o.UlpInline)),{elapsedSeconds:t,decision:Z(le(i,n,r,a))})},e.createUlpItemImpressionBeacon=function(e,t,i,n,r,a,s,l){return L(L({},re(3749,e,i,n,s,l,o.UlpInline)),{itemData:(d=a,d.map((function(e){var t=se(e.detail.item_type);return ae(t,e)}))),decision:Z(le(t,i,n,r))});var d},e.createUlpOpenBeacon=function(e,t,i,n,r,a,s){return L(L({},re(3744,e,i,n,a,s,o.UlpInline)),{decision:Z(le(t,i,n,r))})},e.createUlpViewBeacon=function(e,t,i,n,r,a,s){return L(L({},re(3743,e,i,n,a,s,o.UlpInline)),{decision:Z(le(t,i,n,r))})},e.deferSDKLazyLoad=function(e){U=e},e.environment=u,e.generateSID=function(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e.generateUUID=g,e.getBase=ie,e.getClientParameters=Y,e.getDecisionParameters=Z,e.getEnvironment=J,e.getPlatform=Q,e.getQueryParamArray=te,e.getSDKConfig=function(){return _&&(P.features=_),P},e.getShopperPlatformBase=ne,e.getShopperPlatformCampaign=$,e.getURLParams=function(){var e=window.location.search,t=Object.fromEntries(new URLSearchParams(e));return delete t["flipp-content-code"],0===Object.keys(t).length?null:(P=t,["platform","sdk","siteId","zoneId","userId","locale"].filter((function(e){return e in P})).length<6?null:P)},e.getUlpItemType=se,e.getUserKey=N,e.getViewSize=ee,e.handleMessageFromNative=function(t){var i=t.detail;switch(t.type){case C.EXPERIENCE_LOAD:U(),i.features.length>0&&(_=function(e){var t={};return e.map((function(e){switch(e){case"request-add-to-list":t.addToList=!0;break;case"request-go-to-url":t.goToURL=!0}})),0===Object.keys(t).length?null:t}(i.features));break;case C.EXPERIENCE_VIEWPORT:!function(t){var i,n=null===(i=document.querySelector("iframe"))||void 0===i?void 0:i.contentWindow;if(n){var o=L(L({},t.detail),{screenHeight:window.innerHeight});k.sendMessage(e.PostMessageEvent.INLINE_GEOMETRY,o,n)}}(t)}},e.sendSDKAdDimensions=function(e,t){var i=window.devicePixelRatio,n={contentType:e,contentHeight:t,height:document.body.offsetHeight,devicePixelRatio:i};R(C.CONTENT_READY,n)},e.sendSDKClick=function(e,t,i,n){P=n;var o={contentType:e,id:t,text:i};R(C.REQUEST_TAP,o)},e.sendSDKGoToURL=function(e,t){P=t,R(C.REQUEST_GO_TO_URL,{url:e})},e.sendSDKLoadError=function(){R(C.CONTENT_LOAD_ERROR,{text:"Ad content could not be loaded."})},e.sendSDKPostMessage=R,e.sendSDKRequestAddToList=function(e){R(C.REQUEST_ADD_TO_LIST,{text:e})},e.sendSDKRequestResize=function(e,t){P=t,R(C.REQUEST_RESIZE,{height:e,devicePixelRatio:window.devicePixelRatio})},e.sessionId=G,e.translateDecisionToAvro=le}(i);var n=function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=function(e,t,i){var n=void 0===i?{}:i,o=n.leading,r=void 0===o||o,a=n.trailing,s=void 0!==a&&a,l=!1,d=!1,c=[];return function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];d=!0,c=i,l||(l=!0,r&&(d=!1,e.apply(void 0,c)),setTimeout((function(){s&&d&&e.apply(void 0,c),l=!1,d=!1}),t))}},r=function(e,t,i){if(void 0===i&&(i=2),"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"isIntersecting"in window.IntersectionObserverEntry.prototype){var n="".concat(100*i,"% 0px"),r=new IntersectionObserver((function(e){e.some((function(e){return e.isIntersecting}))&&(t(),r.disconnect())}),{rootMargin:n});r.observe(e)}else{if(a(e.getBoundingClientRect()))return void t();window.addEventListener("scroll",function(e,t){var i=o((function(){a(e.getBoundingClientRect())&&(t(),window.removeEventListener("scroll",i))}),66);return i}(e,t),{passive:!0})}},a=function(e,t){return void 0===t&&(t=2),e.top-window.innerHeight<window.innerHeight*t};function s(e){return void 0!==e["@graph"]}var l='script[type="application/ld+json"]';function d(){var e;try{e=window.parent.document}catch(e){return console.warn("Will not resize or position if on another domain."),null}if(!e)return null;for(var t=e.querySelectorAll("iframe"),i=0;i<t.length;i++){var n=t[i];try{if(window===n.contentWindow)return n}catch(e){continue}}return null}function c(e){var t;if(1===document.body.children.length&&"flipp-"===document.body.children[0].id.substring(0,6)){var i=d();if(i){var n=null===(t=i.contentDocument)||void 0===t?void 0:t.querySelector(".flipp-ux-header"),o=n?n.offsetHeight:0;i.style.height=e+o+"px"}}else console.warn("Will not resize if not only our container present.")}var u=function(e){return e<=18e3?e+2e3:e<=25e3?e+5e3:e+1e4},p=!1,h=function(e,t,i,n,r){void 0===n&&(n=.5),void 0===r&&(r=u);var a=0,s=0,l=2e3,d=i||8e3,c=!1,h=!1,f=!1,m=0,v=null,g=function(e){return function(t){var i;return t.intersectionRect.height>e*((null===(i=t.rootBounds)||void 0===i?void 0:i.height)||window.innerHeight)}}(n),w=function(){var t=Date.now();!p&&a>=d&&(p=!0,e.dispatchEvent(new Event("flipp-engagement"))),a+=t-s,s=t,e.dispatchEvent(new CustomEvent("flipp-heartbeat",{detail:{time:l}})),(l=r(l))<=6e4&&(m=window.setTimeout(w,l-a))},b=function(){c=!1;var e=Date.now()-s;a+=e,s=0,clearTimeout(m)},E=function(){c=!0,s=Date.now(),m=window.setTimeout(w,l-a),f||(f=!0,e.dispatchEvent(new Event("flipp-open")))},y=o((function(){var t=e.getBoundingClientRect(),i=!(t.top>window.innerHeight||t.bottom<0),n=.5*window.innerHeight,o=t.top<n&&t.bottom>n;!h&&i&&(h=!0,e.dispatchEvent(new Event("flipp-view"))),!c&&o?E():c&&!o&&b()}),66);if(t){var I=window.innerHeight/2/e.clientHeight,x=Math.min(1,Math.max(.001,I));(v=new IntersectionObserver((function(t){!h&&t.some((function(e){return e.isIntersecting}))&&(h=!0,e.dispatchEvent(new Event("flipp-view"))),!c&&t.some((function(e){return g(e)}))?E():c&&t.every((function(e){return!g(e)}))&&b()}),{threshold:[0,.9*x,x,1.1*x,1],rootMargin:"0px 1000px 0px 1000px",root:null})).observe(e)}else window.addEventListener("scroll",y);return function(){return window.clearTimeout(m),v&&v.disconnect(),window.removeEventListener("scroll",y),a+Date.now()-s}},f=function(){function t(e,t,o,r,a,s,l,d,c){var u=this;this.hasScrolledBeyond=!1,this._preview=!1,this._expandCount=0,this.handlePostMessages=function(e){if(u.iframe&&e.source===u.iframe.contentWindow){var t=e.data,n=t.type,o=t.data;if(n)if(t.type!==i.PostMessageEvent.ULP)switch(n.replace(i.REQUEST_PREFIX,"")){case i.PostMessageEvent.APP_CONFIG:u.handleAppConfig();break;case i.PostMessageEvent.INLINE_GEOMETRY:u.handleInlineGeometry();break;case i.PostMessageEvent.IFRAME_HEIGHT_RESIZE:u.handleIframeHeightResize(o);break;case i.PostMessageEvent.END_PREVIEW:u.handleEndPreview()}else if(t.detail.type===i.ULPMessageEvent.ITEM_IMPRESSION){var r=t.detail.items.map((function(e){return e.detail}));u.handleUlpItemImpressions(r)}else u.handleUlpPostMessages(t.detail)}},this.handleUlpPostMessages=function(e){var t;if(p||window.dispatchEvent(new Event("flipp-engagement")),u.sdk){var n=e.detail.id?e.detail.id:e.detail.flyer_item_id;i.sendSDKClick(i.UXType.ULP,n,e.detail.name,u.sdk),e.type!==i.ULPMessageEvent.SEE_FLYER_ITEM&&e.type!==i.ULPMessageEvent.SEE_MERCHANT_ITEM&&e.type!==i.ULPMessageEvent.SEE_ECOM_ITEM||i.sendSDKGoToURL(e.detail.url,u.sdk)}switch(e.type){case i.ULPMessageEvent.CLICK_MEATBALL:t=i.getUlpItemType(e.detail.itemType);break;case i.ULPMessageEvent.SEE_FLYER_ITEM:case i.ULPMessageEvent.CLIP_FLYER_ITEM:t=i.AnalyticBeacons.ItemType.Flyer;break;case i.ULPMessageEvent.SEE_MERCHANT_ITEM:case i.ULPMessageEvent.CLIP_MERCHANT_ITEM:t=i.AnalyticBeacons.ItemType.Merchant;break;case i.ULPMessageEvent.SEE_ECOM_ITEM:case i.ULPMessageEvent.CLIP_ECOM_ITEM:t=i.AnalyticBeacons.ItemType.Ecom;break;default:throw new Error("ULP message not recognized")}u.handleUlpClick(t,e)},this.scrollBeyond=function(){var e,t;if(!u.hasScrolledBeyond&&(u.hasScrolledBeyond=!0,u.data.storefront)){var o={sfmlUUID:u.data.storefront.sfml_uuid||"-1",version:null,contentHash:null},r=n(n({},i.createBaseBeacon(i.AnalyticBeacons.ExperienceScrolledBeyondSlotSchemaId,u.publisherNameIdentifier,u.siteId,u.zoneIds[0]||0,null===(e=u.geoData)||void 0===e?void 0:e.postal_code,null===(t=u.kevelMetadata)||void 0===t?void 0:t.campaignNameIdentifier)),{storefront:o,merchant:{merchantId:u.data.storefront.merchant_id||-1},decision:i.getDecisionParameters(i.translateDecisionToAvro(u.data,u.siteId,u.zoneIds[0]||0,u.getCustomUrl())),height:u.getHeight(),expansionCount:u.expandCount,flyer:{flyerId:u.data.storefront.flyer_id||-1,flyerRunId:u.data.storefront.flyer_run_id||-1,flyerTypeId:u.data.storefront.flyer_type_id||-1,storeId:null,premium:!0}});i.AnalyticsQueue.enqueue(r)}},this.targetEl=e,this.publisherNameIdentifier=t,this.data=o,this.options=r,this.resizeCallback=a,this.handlePreviewEnded=d,this.siteId=s,this.zoneIds=l,this._preview=r.preview||!1,this.geoData=c,this.sdk=i.getSDKConfig(),this.intersectionObserver="IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"isIntersecting"in window.IntersectionObserverEntry.prototype}return Object.defineProperty(t.prototype,"preview",{get:function(){return this._preview},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expandCount",{get:function(){return this._expandCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contentElement",{get:function(){return this._contentElement},enumerable:!1,configurable:!0}),t.prototype.sendMessage=function(e,t){var i;this.iframe&&(null===(i=this.iframe.contentWindow)||void 0===i||i.postMessage({type:e,data:t},"*"))},t.prototype.sendCountdownState=function(e,t){this.sendMessage(i.PostMessageEvent.COUNTDOWN_STATE,{countdownEnd:e,countdownInterval:t})},t.prototype.requestExpand=function(){this.sendMessage(i.PostMessageEvent.REQUEST_EXPAND,!0)},t.prototype.handleAppConfig=function(){var e,t,n,o,r,a,s;if(this.kevelMetadata){var l=navigator.languages?navigator.languages[0]:navigator.language;this.sendMessage(i.PostMessageEvent.APP_CONFIG,{campaignNameIdentifier:this.kevelMetadata.campaignNameIdentifier,ux:"inline",adView:this.options.isGoogleAmp?"safeframe":"native",intersectionObserver:this.intersectionObserver,site:this.options.overrideHostname||window.location.hostname,locale:(null!==(t=null===(e=this.sdk)||void 0===e?void 0:e.locale)&&void 0!==t?t:l).substring(0,2),country:null===(n=this.geoData)||void 0===n?void 0:n.country,partnerNameIdentifier:this.publisherNameIdentifier,campaignConfigUrl:this.kevelMetadata.campaignConfigUrl,ulpUrl:this.kevelMetadata.ulpUrl,survey:this.kevelMetadata.survey,tags:{campaignManagement:{open:this.impressionUrl,engagement:this.engagementUrl}},expandOnReadMore:!!this.options.dwellExpandable||!!this.options.expandOnReadMore,preventItemModalClose:this.kevelMetadata.preventItemModalClose,creativeEvTimerMs:this.kevelMetadata.evTimerMs,hideHeader:this.kevelMetadata.hideHeader,themeColorBg:this.kevelMetadata.themeColorBg,themeColorFg:this.kevelMetadata.themeColorFg,sessionId:i.sessionId,uid:null!==(r=null===(o=this.sdk)||void 0===o?void 0:o.userId)&&void 0!==r?r:i.getUserKey(this.options),startCompact:!!this.options.startCompact,decision:i.translateDecisionToAvro(this.data,this.siteId,this.zoneIds[0],this.getCustomUrl()),platform:i.getPlatform(),userPostalCode:null===(a=this.geoData)||void 0===a?void 0:a.postal_code,sdk:this.sdk,storefrontConfig:null===(s=this.data)||void 0===s?void 0:s.storefront,noPopOnLink:this.kevelMetadata.noPopOnLink||!1})}},t.prototype.handleInlineGeometry=function(){if(this.containerElement&&this.containerWindow&&this.contentElement){var t=e(this.containerElement,this.contentElement,this.containerWindow);null!=t&&this.sendMessage(i.PostMessageEvent.INLINE_GEOMETRY,t)}},t.prototype.handleEndPreview=function(){if(this.iframe){this._preview=!1;var e=this.creativeWidth&&this.creativeHeight?this.creativeHeight/this.creativeWidth:6,t=this.iframe.offsetWidth*e;this.iframe.style.height=t+"px",this.sendMessage(i.PostMessageEvent.END_PREVIEW,!0),this.handlePreviewEnded(this)}},t.prototype.getHeight=function(){return this.iframe?this.iframe.offsetHeight:0},t.prototype.getAdType=function(){var e,t;return(null===(e=this.kevelMetadata)||void 0===e?void 0:e.survey)?i.UXType.SURVEY:(null===(t=this.kevelMetadata)||void 0===t?void 0:t.ulpUrl)?i.UXType.ULP:i.UXType.INLINE},t.prototype.handleIframeHeightResize=function(e){if(this.iframe){var t=Math.ceil(e.height);this.iframe.offsetHeight<t&&(this._expandCount++,1===this.expandCount&&(this.hasScrolledBeyond=!1)),this.iframe.style.height=t+"px",this.resizeCallback(this,t+8)}},t.prototype.handleUlpClick=function(e,t){var o;i.AnalyticsQueue.enqueue(i.createUlpClickBeacon(this.publisherNameIdentifier,n({},this.data),this.siteId,this.zoneIds[0]||0,this.getCustomUrl(),t,e,null===(o=this.geoData)||void 0===o?void 0:o.postal_code))},t.prototype.handleUlpItemImpressions=function(e){var t;i.AnalyticsQueue.enqueue(i.createUlpItemImpressionBeacon(this.publisherNameIdentifier,n({},this.data),this.siteId,this.zoneIds[0]||0,this.getCustomUrl(),e,null===(t=this.geoData)||void 0===t?void 0:t.postal_code))},t.prototype.getCustomUrl=function(){var e,t;return(null===(e=this.kevelMetadata)||void 0===e?void 0:e.ulpUrl)||(null===(t=this.kevelMetadata)||void 0===t?void 0:t.campaignConfigUrl)||"no-url"},t.prototype.registerScroll=function(){var t=this;this.containerWindow&&!this.options.isGoogleAmp&&this.containerWindow.addEventListener("scroll",o((function(){if(t.containerWindow&&t.containerElement&&t.contentElement){var n=e(t.containerElement,t.contentElement,t.containerWindow);null!==n&&t.sendMessage(i.PostMessageEvent.INLINE_GEOMETRY,n)}}),66,{leading:!1,trailing:!0}))},t.prototype.registerTags=function(){var e={open:this.impressionUrl,engagement:this.engagementUrl};i.Tags.addTags({campaignManagement:e})},t.prototype.initGoogleAmp=function(e,t){var n=this;window.parent.postMessage({sentinel:"amp",type:"send-intersections"},"*"),window.parent.postMessage({sentinel:"amp",type:"embed-size",width:e,height:t},"*"),window.addEventListener("message",(function(e){e.source===window.parent&&e.origin!==window.location.origin&&e.data&&"amp"===e.data.sentinel&&"intersection"===e.data.type&&e.data.changes.forEach((function(e){if(e.boundingClientRect.height<250)n.sendMessage(i.PostMessageEvent.INLINE_GEOMETRY,{yiv:0,h:0});else{var t={self:{yiv:e.intersectionRatio,h:e.boundingClientRect.height}};n.sendMessage(i.PostMessageEvent.INLINE_GEOMETRY,t)}}))}))},t.prototype.render=function(){var e,t,o=this;if(null==this.data||null==this.data.contents||0===this.data.contents.length)return this.resizeCallback(this,0),void(this.sdk&&i.sendSDKLoadError());this.kevelMetadata=this.data.contents[0].data.customData,this.creativeWidth=this.data.width,this.creativeHeight=this.data.height,this.engagementUrl=this.data.clickUrl,this.impressionUrl=this.data.impressionUrl,this.registerTags();var r=this.targetEl,a=r.querySelector(".flipp-ux-header");a&&!this.kevelMetadata.hideHeader&&(a.style.display="block");var s=this.creativeWidth&&this.creativeHeight?this.creativeHeight/this.creativeWidth:6,l=Math.max(Math.min(r.offsetWidth,1024),300),c=Math.min(this.options.preview?200:l*s,this.options.startCompact?this.options.compactHeight||600:2400);if(this.options.isGoogleAmp&&this.initGoogleAmp(l,c),!(this._preview&&this.kevelMetadata.ulpUrl||this._preview&&this.kevelMetadata.survey)){this.iframe=document.createElement("iframe"),this.iframe.style.height=c+"px",this.iframe.style.width=this.sdk?"100%":l+"px",this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("frameborder","no"),this.kevelMetadata.ulpUrl||(this.iframe.style.maxWidth=this.options.startCompact?"650px":"800px",this.iframe.style.margin="0 auto",this.iframe.style.display="block");var u="https://shopper.flipp.com/static/0.29.1/latest";this.kevelMetadata.ulpUrl&&(u=this.kevelMetadata.ulpUrl,(null===(e=this.geoData)||void 0===e?void 0:e.postal_code)&&(u="".concat(u,"&postal_code=").concat(null===(t=this.geoData)||void 0===t?void 0:t.postal_code)));var p=new URL(u);if(this.preview&&p.searchParams.append("preview","true"),this.iframe.setAttribute("src",p.toString()),this._contentElement=this.iframe,r.appendChild(this.iframe),this.options.nestedIframe){var f=(null==a?void 0:a.offsetHeight)||0,m=this._preview?200:document.body.offsetHeight+f+8;this.resizeCallback(this,m)}this.containerWindow=window,this.containerElement=r,this.options.nestedIframe&&(this.containerWindow=window.parent,this.containerElement=d()||r),this.intersectionObserver||(console.log("Register Event Listeners"),this.registerScroll()),window.addEventListener("message",(function(e){o.handlePostMessages(e)})),this.iframe.addEventListener("flipp-view",(function(){var e,t;i.AnalyticsQueue.enqueue(i.createUlpViewBeacon(o.publisherNameIdentifier,n({},o.data),o.siteId,o.zoneIds[0]||0,o.getCustomUrl(),null===(e=o.geoData)||void 0===e?void 0:e.postal_code,null===(t=o.kevelMetadata)||void 0===t?void 0:t.campaignNameIdentifier))})),this.iframe.addEventListener("flipp-open",(function(){var e,t;i.AnalyticsQueue.enqueue(i.createUlpOpenBeacon(o.publisherNameIdentifier,n({},o.data),o.siteId,o.zoneIds[0]||0,o.getCustomUrl(),null===(e=o.geoData)||void 0===e?void 0:e.postal_code,null===(t=o.kevelMetadata)||void 0===t?void 0:t.campaignNameIdentifier)),i.Tags.sendOpen()}),{once:!0}),this.iframe.addEventListener("flipp-heartbeat",(function(e){var t,r,a=e.detail.time;i.AnalyticsQueue.enqueue(i.createUlpHeartbeatBeacon(o.publisherNameIdentifier,Math.round(a/1e3),n({},o.data),o.siteId,o.zoneIds[0]||0,o.getCustomUrl(),null===(t=o.geoData)||void 0===t?void 0:t.postal_code,null===(r=o.kevelMetadata)||void 0===r?void 0:r.campaignNameIdentifier))})),this.iframe.addEventListener("flipp-engagement",(function(){var e,t;i.AnalyticsQueue.enqueue(i.createUlpEngagementBeacon(o.publisherNameIdentifier,n({},o.data),o.siteId,o.zoneIds[0]||0,o.getCustomUrl(),null===(e=o.geoData)||void 0===e?void 0:e.postal_code,null===(t=o.kevelMetadata)||void 0===t?void 0:t.campaignNameIdentifier)),i.Tags.sendEngagement()}),{once:!0}),this.kevelMetadata.ulpUrl&&h(this.iframe,this.intersectionObserver,this.kevelMetadata.evTimerMs),this.sdk&&(this.iframe.onload=function(){var e;(null===(e=o.data)||void 0===e?void 0:e.height)?i.sendSDKAdDimensions(o.getAdType(),o.data.height):i.sendSDKLoadError()})}},t}(),m=[4309,641],v=3e3,g=/(Googlebot-Mobile|Googlebot-Image|Googlebot-News|Googlebot-Video|Googlebot\/|AdsBot-Google([^-]|$)|AdsBot-Google-Mobile|Feedfetcher-Google|Mediapartners-Google|Mediapartners \(Googlebot\)|APIs-Google|bingbot|Slurp|YandexBot|LinkedInBot)/,w=function(){function e(e,t,n,o,r){var a=this;this.experienceLimit=16,this.tickCountdown=function(){if(void 0!==a.countdownStart&&void 0!==a.countdownExperience){var e=Date.now()-a.countdownStart,t=a.getDwellDuration(a.countdownExperience),i=a.experiences[a.countdownExperience],n=t/a.getDwellSteps(a.countdownExperience)+.01;i.sendCountdownState(a.countdownStart+t,n),e>=t&&a.completeCountdown()}},this.observerCallback=function(e){for(var t=0;t<e.length;t++)for(var i=e[t],n=i.target,o=0;o<a.markers.length;o++)a.markers[o].el===n&&(a.markers[o].active=i.isIntersecting);var r=!1;for(t=0;t<a.markers.length;t++){var s=a.markers[t],l=a.experiences[t],d=t>0?a.experiences[t-1]:null,c=d&&d.expandCount>=2;(!l.preview&&l.expandCount<2||l.preview&&c)&&!r&&s.active?(a.countdownExperience!==t&&(a.stopCountdown(),l.expandCount<1&&a.startCountdown(t)),r=!0):s.active||a.countdownExperience!==t||a.stopCountdown()}},this.scrollBeyondCallback=function(e){e.filter((function(e){return e.isIntersecting})).map((function(e){return a.markers.find((function(t){return t.el===e.target}))})).filter((function(e){return e&&a.experiences[e.index]})).forEach((function(e){return a.experiences[e.index].scrollBeyond()}))},this.scrollIntoViewCallback=function(e){},this.resizeExperience=function(e,t){a.options.nestedIframe&&a.targetEl&&e.contentElement&&(e.contentElement.style.height=t+"px",c(a.targetEl.offsetHeight))},this.handlePreviewEnded=function(e){a.appendPreview()},this.targetSelector=e,this.publisherNameIdentifier=t?t.toString():"undefined",this.siteId=i.asNumber(n),this.zoneIds=o.map((function(e){return i.asNumber(e)})),this.options=r,this.requested=!1,this.experiences=[],this.markers=[],this.experienceLimit=r.experienceLimit||16,this.dwellObserver=new IntersectionObserver(this.observerCallback,{rootMargin:"-70% 0px -5% 0px"}),this.scrollBeyondObserver=new IntersectionObserver(this.scrollBeyondCallback,{rootMargin:"-95% 0px 0px 0px"}),this.scrollIntoView=new IntersectionObserver(this.scrollIntoViewCallback,{threshold:.2})}return e.prototype.completeCountdown=function(){if(void 0!==this.countdownExperience){var e=this.experiences[this.countdownExperience];e.preview?(e.handleEndPreview(),this.appendPreview()):e.requestExpand(),this.stopCountdown()}},e.prototype.stopCountdown=function(){(this.countdownInterval&&window.clearInterval(this.countdownInterval),void 0!==this.countdownExperience)&&this.experiences[this.countdownExperience].sendCountdownState();this.countdownInterval=void 0,this.countdownExperience=void 0,this.countdownStart=void 0},e.prototype.startCountdown=function(e){var t=this.getDwellDuration(e)/this.getDwellSteps(e);this.countdownExperience=e,this.countdownStart=Date.now(),this.tickCountdown(),this.countdownInterval=window.setInterval(this.tickCountdown,t)},e.prototype.getDwellDuration=function(e){var t,n,o,r,a;return(null===(o=null===(n=null===(t=this.decisionPayload)||void 0===t?void 0:t.decisions)||void 0===n?void 0:n.inline[e].contents[0].data.customData)||void 0===o?void 0:o.dwellTimerMs)?i.asNumber((null===(a=null===(r=this.decisionPayload)||void 0===r?void 0:r.decisions)||void 0===a?void 0:a.inline[e].contents[0].data.customData.dwellTimerMs)||v,v):v},e.prototype.getDwellSteps=function(e){var t,n,o,r,a;return(null===(o=null===(n=null===(t=this.decisionPayload)||void 0===t?void 0:t.decisions)||void 0===n?void 0:n.inline[e].contents[0].data.customData)||void 0===o?void 0:o.dwellSteps)?i.asNumber((null===(a=null===(r=this.decisionPayload)||void 0===r?void 0:r.decisions)||void 0===a?void 0:a.inline[e].contents[0].data.customData.dwellSteps)||3,3):3},e.prototype.request=function(){var e=this;this.requested||(this.targetEl=document.querySelector(this.targetSelector),this.targetEl?(i.getURLParams()?i.deferSDKLazyLoad((function(){return e.getExperiences()})):r(this.targetEl,(function(){return e.getExperiences()})),this.requested=!0):console.log("No target div found for",this.targetSelector))},e.prototype.insertPassback=function(e){if(this.targetEl){var t=document.createElement("iframe");t.src="about:blank",t.style.width=this.options.passbackWidth||"100%",t.style.height=this.options.passbackHeight||"600px",t.setAttribute("scrolling","no"),t.setAttribute("frameborder","no"),this.targetEl.appendChild(t),t.contentWindow&&(t.contentWindow.document.open(),t.contentWindow.document.write(e),t.contentWindow.document.close())}},e.prototype.addExperience=function(e,t){var i,n,o,r,a;void 0===t&&(t=0);var s=(null===(o=null===(n=null===(i=this.decisionPayload)||void 0===i?void 0:i.decisions)||void 0===n?void 0:n.inline)||void 0===o?void 0:o.length)||0;if(this.targetEl&&this.decisionPayload&&!(t>=s)){var l=new f(this.targetEl,this.publisherNameIdentifier,null===(a=null===(r=this.decisionPayload)||void 0===r?void 0:r.decisions)||void 0===a?void 0:a.inline[t],this.options,this.resizeExperience,this.siteId,this.zoneIds,this.handlePreviewEnded,this.decisionPayload.location);this.experiences.push(l),l.render();var d=document.createElement("div");d.style.height="0px",this.targetEl.appendChild(d),this.markers.push({el:d,active:!1,index:t}),this.scrollBeyondObserver.observe(d),this.options.dwellExpandable&&this.dwellObserver.observe(d),this.scrollIntoView.observe(this.targetEl)}},e.prototype.appendPreview=function(){var e,t,i=(null===(t=null===(e=this.decisionPayload)||void 0===e?void 0:e.decisions)||void 0===t?void 0:t.inline.length)||0;this.decisionPayload&&(this.experienceLimit<=this.experiences.length||i<=this.experiences.length||this.addExperience(!0,this.experiences.length))},e.prototype.getGeolocatedExperience=function(e){var t=this;g.test(navigator.userAgent)||(this.queueRequestMadeBeacon(),fetch("https://gateflipp.flippback.com/flyer-locator-service/campaigns",{method:"POST",credentials:"omit",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((function(e){return e.ok||t.queueFailureBeacon(e),e.json()})).then((function(e){if(t.queueSuccessBeacon(e),t.decisionPayload=e,!t.options.passbackTag||e.decisions&&e.decisions.inline&&!(e.decisions.inline.length<1)&&null!==e.decisions.inline[0])(t.options.nestedIframe&&!e.decisions||!e.decisions.inline||e.decisions.inline.length<1||null===e.decisions.inline[0])&&c(0),t.addExperience();else{var i="function"==typeof t.options.passbackTag?t.options.passbackTag():t.options.passbackTag;if("object"==typeof i&&"function"==typeof i.then)return i.then((function(e){if(!e)throw new Error(JSON.stringify(e));t.insertPassback(e)})).catch((function(e){var t=e instanceof Error?e.message:"unknown";throw new Error("Passback promise fallthrough. Hiding experience: "+t)}));if("string"!=typeof i||!i)throw new Error("Passback fallthrough. Hiding experience");t.insertPassback(i)}})).catch((function(e){e instanceof Error&&e.message.startsWith("Passback")?console.warn("Flipp Experience failed to load: ",e.message):(i.Logger.error("Slot error",e),t.queueErrorBeacon(e)),t.options.nestedIframe&&0===t.experiences.length&&c(0)})))},e.prototype.getExperiences=function(){var e={divName:"inline",networkId:10922,siteId:this.siteId,adTypes:m,count:1};void 0!==this.zoneIds&&null!=this.zoneIds&&this.zoneIds.length>0&&(e.zoneIds=this.zoneIds);var t={},n=new URL(window.location.toString()).searchParams.get("flipp-content-code");n&&n.length>0&&(t.contentCode=n.slice(0,32)),e.properties=t;var o=function(){var e=document.querySelectorAll(l),t=[];if(!e)return t;for(var i=function(e){"NewsArticle"===e["@type"]&&t.push.apply(t,e.keywords||[])},n=0;n<e.length;n++){var o=e[n];try{var r=JSON.parse(o.innerText);if(s(r))for(var a=0,d=r["@graph"];a<d.length;a++)i(d[a]);else if(Array.isArray(r))for(var c=0,u=r;c<u.length;c++)i(u[c]);else i(r)}catch(e){continue}}return t}(),r={placements:[e],url:window.location.href,keywords:o},a=i.getUserKey(this.options);a&&(r.user={key:a}),this.getGeolocatedExperience(r),this.queueRequestContextBeacon(o)},e.prototype.queueRequestContextBeacon=function(e){var t="".concat(location.origin).concat(location.pathname),n=Array.from(new URLSearchParams(window.location.search).entries());i.AnalyticsQueue.enqueue(i.createDecisionRequestContextBeacon(this.publisherNameIdentifier,this.siteId,this.zoneIds[0]||0,void 0,void 0,e,function(){var e=document.querySelectorAll(l),t="Unknown";if(!e)return t;for(var i=function(e){var t=e["@type"];return"Recipe"===t?"Recipe":"NewsArticle"===t?"News":null},n=0;n<e.length;n++){var o=e[n];try{var r=JSON.parse(o.innerText);if(s(r))for(var a=0,d=r["@graph"];a<d.length;a++)t=i(d[a])||t;else if(Array.isArray(r))for(var c=0,u=r;c<u.length;c++)t=i(u[c])||t;else t=i(r)||t}catch(e){continue}}return t}(),t,n))},e.prototype.queueRequestMadeBeacon=function(){i.AnalyticsQueue.enqueue(i.createDecisionRequestMadeBeacon(this.publisherNameIdentifier,this.siteId,this.zoneIds[0]||0,void 0,void 0))},e.prototype.queueFailureBeacon=function(e){i.AnalyticsQueue.enqueue(i.createDecisionResponseFailureBeacon(this.publisherNameIdentifier,this.siteId,this.zoneIds[0]||0,void 0,void 0,"Campaigns request failed",e.status))},e.prototype.queueSuccessBeacon=function(e){var t,n,o=(null===(t=e.decisions)||void 0===t?void 0:t.inline)&&e.decisions.inline[0].contents.length>0,r=function(e){var t;if((null===(t=e.decisions)||void 0===t?void 0:t.inline)&&e.decisions.inline.length>0){var i=e.decisions.inline[0].contents[0].data.customData;if(i.campaignConfigUrl)return i.campaignConfigUrl;if(i.ulpUrl)return i.ulpUrl}return"no-campaign-url-nor-ulp"}(e),a=(null===(n=e.decisions)||void 0===n?void 0:n.inline)?[{campaignId:e.decisions.inline[0].campaignId,siteId:i.asNumber(this.siteId),zoneId:i.asNumber(this.zoneIds[0])||0,adId:e.decisions.inline[0].adId,creativeId:e.decisions.inline[0].creativeId,flightId:e.decisions.inline[0].flightId,advertiserId:e.decisions.inline[0].advertiserId,customUrl:o?{string:r}:null}]:[],s=null==e?void 0:e.location;i.AnalyticsQueue.enqueue(i.createDecisionResponseSuccessBeacon(this.publisherNameIdentifier,this.siteId,this.zoneIds[0]||0,null==s?void 0:s.country,null==s?void 0:s.postal_code,a))},e.prototype.queueErrorBeacon=function(e){i.AnalyticsQueue.enqueue(i.createDecisionResponseFailureBeacon(this.publisherNameIdentifier,this.siteId,this.zoneIds[0]||0,void 0,void 0,e.message+" - "+(e.stack||""),0))},e}(),b=function(){function e(){var e=this;this.handleReadyStateChange=function(){e.checkReady()&&(e.waitingForDocument=!1,e.load(),document.removeEventListener("readystatechange",e.handleReadyStateChange))},this.waitingForDocument=!1,this.slots=[]}return e.prototype.checkReady=function(){var e=this.slotsAllInDocument();return!(!e||"interactive"!==document.readyState&&"complete"!==document.readyState)||(!(!this.anySlotInDocument()||"complete"!==document.readyState)||(e||console.info("Missing slot target div at state",document.readyState),!1))},e.prototype.anySlotInDocument=function(){for(var e=0,t=this.slots;e<t.length;e++){var i=t[e];if(document.querySelector(i.targetSelector))return!0}return!1},e.prototype.slotsAllInDocument=function(){for(var e=0,t=this.slots;e<t.length;e++){var i=t[e];if(!document.querySelector(i.targetSelector))return!1}return!0},e.prototype.load=function(){for(var e=0,t=this.slots;e<t.length;e++){t[e].request()}},e.prototype.register=function(e,t,i,o,r){void 0===r&&(r={});var a=window.flippxp.settings||{},s=new w(e,t,i,o,n(n({},a),r));this.slots.push(s),this.checkReady()?this.load():this.waitingForDocument||(this.waitingForDocument=!0,document.addEventListener("readystatechange",this.handleReadyStateChange))},e}(),E=!1;for(window.handleMessageFromNative=i.handleMessageFromNative,window.flippxp=window.flippxp||{run:[]},window.flippxp.calculateGeomData=e,window.flippxp.overrideOptions=function(e){var t=new URL(window.location.toString());"true"===t.searchParams.get("flipp-test-dwell-expandable")&&(e.dwellExpandable=!0);var n=t.searchParams.get("flipp-test-experience-limit"),o=i.asNumber(n,0);return o&&(e.experienceLimit=Math.max(1,o)),e},window.flippxp.registerSlot=function(e,t,n,o,r){void 0===r&&(r={}),E||(E=!0,i.AnalyticsQueue.enqueue(i.createAppInitializedBeacon(t,n,o[0]||0))),window.flippxp.slotManager=window.flippxp.slotManager||new b,window.flippxp.slotManager.register(e,t,n,o,window.flippxp.overrideOptions(r))};window.flippxp.run.length>0;){window.flippxp.run.shift()()}window.flippxp.run.push=function(e){e()}}();
//# sourceMappingURL=flipptag.js.map


  window.flippxp.run.push(async function () {
    window.flippxp.registerSlot(
      '#flipp-scroll-ad-content',
      'wishabi-test-publisher',
      1191862,
      [260678],
      { dwellExpandable: true, experienceLimit: 1 },
    );
  });
}

async function clearFlippExperience() {
  var e = document.getElementById("flipp-scroll-ad-content");
  e.innerHTML = "";
}

async function selectInjection() {
  var html = `<div class="iframe-container" id="flipp-container">
<div id="flipp-scroll-ad-content">
  <div style="font-size: 20px; background-color: green; height: 100px;">
    WILL BE INJECTED HERE!
  </div>
</div>
</div>`

document.body.addEventListener("click", async function (evt) {
  var e = document.getElementById("flipp-container");
  if (e) {
    e.remove();
  }
  console.dir(this);
  console.log(evt.target);
  evt.target.insertAdjacentHTML("afterEnd", html);
}, { once: true });


}

async function addFlipp(tabId) {
  const [{result}] = await chrome.scripting.executeScript({
    func: addFlippExperience,
    target: {
      tabId: tabId ??
        (await chrome.tabs.query({active: true, currentWindow: true}))[0].id
    },
    world: 'MAIN',
  });
  return result;
}

async function clearFlipp(tabId) {
  const [{result}] = await chrome.scripting.executeScript({
    func: clearFlippExperience,
    target: {
      tabId: tabId ??
        (await chrome.tabs.query({active: true, currentWindow: true}))[0].id
    },
    world: 'MAIN',
  });
  return result;
}

async function selectFlipp(tabId) {
  const [{result}] = await chrome.scripting.executeScript({
    func: selectInjection,
    target: {
      tabId: tabId ??
        (await chrome.tabs.query({active: true, currentWindow: true}))[0].id
    },
    world: 'MAIN',
  });
  return result;
}

const inject = document.getElementById("inject");
inject.addEventListener("click", async (event) => {
  (async () => {
    await addFlipp();
  })();
});

const clear = document.getElementById("clear");
clear.addEventListener("click", async (event) => {
  (async () => {
    await clearFlipp();
  })();
});

const select = document.getElementById("select");
select.addEventListener("click", async (event) => {
  (async () => {
    await selectFlipp();
  })();
});
